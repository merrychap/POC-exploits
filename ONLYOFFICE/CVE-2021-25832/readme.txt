[ Description ]
A heap buffer overflow vulnerability inside of BMP image processing was found at
[core] module of ONLYOFFICE DocumentServer v4.0.0-9-v6.0.0. Using this vulnerability,
an attacker is able to gain remote code executions on DocumentServer.

[Vulnerability Type]
Heap Buffer Overflow (CWE-122 CWE-787 CWE-823)

[Affected Code Base]
DocumentServer: https://github.com/ONLYOFFICE/DocumentServer
affected versions: v4.0.0-9 - v6.0.0; fixed version: v6.0.1

core: https://github.com/ONLYOFFICE/core
affected versions: v4.2.0.236 - v6.0.1.15; fixed version: v6.0.1.21

[Affected Component]
Affected module: https://github.com/ONLYOFFICE/core/tree/v6.0.1.15
Affected functions:
  NSBinPptxRW::CImageManager2::GenerateImageExec,
  NSBinPptxRW::CImageManager2::SaveImageAsPng,
  CBgraFrame::OpenFile,
  CxImage::Decode,
  CxImageBMP::Decode
Affected executable: x2t

[Attack Type]
Remote

[Impact]
Code Execution
Denial of Service

[Attack Vectors]
To exploit this vulnerability an attacker must send a request to convert a
crafted file from DOCT into DOCX format. DocumentServer supports the 
processing of inlined images inside of DOCT binary file. There is a heap
buffer overflow bug inside of BMP image processing in [cximage] 
submodule of [core] module. This vulnerability has a powerful heap 
controlling primitive: using designed logic it can be possible to write
data of arbitrary size at an arbitrary offset from the allocated chunk.
Using this primitive an attacker can overwrite the global path to the media
directory which is used to store converted pictures. By overwriting this
global path an attacker obtains arbitrary file overwriting primitive on
DocumentServer filesystem and eventually gets remote code execution on remote
DocumentServer by overwriting x2t binary (responsible for format conversion)
and then sending a new request triggering the payload already written into x2t 
binary (reverse shell for example)
